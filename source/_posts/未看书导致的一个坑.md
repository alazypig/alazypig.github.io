---
title: 未看书导致的一个坑
date: 2018-08-10 15:56:26
tags:
- '学习'
---
某日被书中一段代码误导
{% codeblock lang:javascript %}
var promise = new Promise(function (resolve, reject) {
    resolve('ok');
    setTimeout(function() { throw new Error('test') }, 0);
});
promise.then(function (value) { console.log(value) });
//ok
//Uncaught Error : test
{% endcodeblock %}
由于前面还有这样一段话
{% blockquote %}
如果Promise状态已经变成Resolved，再抛出错误是无效的。
{% endblockquote %}
当时看到这，思索了许久，为什么已经resolve了这个ERROR还是可以往外抛出呢？
后面发现，settimeout是一个异步函数，throw会在下一轮事件循环开始时抛出，所以无论是否resolve，这个ERROR都是会抛出的。
